<!DOCTYPE html>
<html>
  <head>
    <title>Node Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
    <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
    <style>
    * {
      -webkit-user-select: none;
    }
    div {
      width: 75px;
      height: 75px;
    }
      #left {
        position: relative;
        background: #ff0000;
        top: 75px;
      }
      #right {
        position: relative;
        background: #00ff00;
        left: 150px;
      }
      #down {
        position: relative;
        left: 75px;
        top: -75px;
        background: #0000ff;
      }
      #up {
        position: relative;
        top: -150px;
        left: 75px;
        background: #ff00ff;
      }
      #a-button {
        position: relative;
        top: -250px;
        left: 400px;
        width: 100px;
        height: 100px;
        background: #00ff00;
      }
      .ui-loader {
        display: none;
      }
      .ui-page {
        min-height: 0px !important;
      }
    </style>
  </head>
  <body>
      <div id="left"></div>
      <div id="right"></div>
      <div id="up"></div>
      <div id="down"></div>

      <div id="a-button"></div>

    <script>
      function makeid()
      {
          var text = "";
          var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

          for( var i=0; i < 5; i++ )
              text += possible.charAt(Math.floor(Math.random() * possible.length));

          return text;
      }

      // var socket = io.connect('http://facebook-hack.nodejitsu.com');
      var socket = io.connect('http://192.17.207.254:8000');

      var mId = makeid();

      socket.emit('new-player', { id : mId });

      function registerAsButton(element, event, data){

        // element.on({
        //   'touchend':function(e){
        //     socket.emit(event, $.extend(data, {down: false, id: mId}));
        //   },
        //   'touchstart': function(e){
        //     socket.emit(event, $.extend(data, {down: true, id: mId}));
        //   },
        //   'touchcancel': function(e){
        //     socket.emit(event, $.extend(data, {down: false, id: mId}));
        //   },
        // });

        element.on({
          'vmousedown': function(e){
            socket.emit(event, $.extend(data, {pressed: true, id: mId}));
          },
          'vmouseup':function(e){
            socket.emit(event, $.extend(data, {pressed: false, id: mId}));
          },
          'vmousecancel': function(e){
            socket.emit(event, $.extend(data, {pressed: false, id: mId}));
         },
        });
      }
      registerAsButton($('#left'), 'move', {dir: 'left'});
      registerAsButton($('#right'), 'move', {dir: 'right'});
      registerAsButton($('#up'), 'move', {dir: 'up'});
      registerAsButton($('#down'), 'move', {dir: 'down'});

      registerAsButton($('#a-button'), 'action-button', { btn: 'a-btn' });
    </script>
  </body>
</html>
